\documentclass[12pt, letterpaper]{article}

\usepackage[utf8]{inputenc}
\usepackage{url}
\usepackage[dvipsnames]{xcolor}
\usepackage{listings}

\lstset{
  backgroundcolor=\color{lightgray!10},
  xleftmargin=5mm,
  framexleftmargin=1em,
  frame=single,
  basicstyle=\fontsize{9}{11}\ttfamily,
  columns=fullflexible,
  frame=single,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
}

\lstdefinelanguage{Kotlin}{
  comment=[l]{//},
  commentstyle={\color{gray}\ttfamily},
  emph={delegate, filter, first, firstOrNull, forEach, lazy, map, mapNotNull, println, return@},
  emphstyle={\color{OrangeRed}},
  identifierstyle=\color{black},
  keywords={abstract, actual, as, as?, break, by, class, companion, continue, data, do, dynamic, else, enum, expect, false, final, for, fun, get, if, import, in, interface, internal, is, null, object, override, package, private, public, return, set, super, suspend, this, throw, true, try, typealias, val, var, vararg, when, where, while},
  keywordstyle={\color{NavyBlue}\bfseries},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
  morestring=[s]{"""*}{*"""},
  ndkeywords={@Deprecated, @JvmField, @JvmName, @JvmOverloads, @JvmStatic, @JvmSynthetic, Array, Byte, Double, Float, Int, Integer, Iterable, Long, Runnable, Short, String},
  ndkeywordstyle={\color{BurntOrange}\bfseries},
  sensitive=true,
  stringstyle={\color{ForestGreen}\ttfamily},
}

\definecolor{darkgray}{rgb}{.4,.4,.4}
\lstdefinelanguage{Groovy}[]{Java}{
  keywordstyle=\color{NavyBlue}\bfseries,
  stringstyle=\color{ForestGreen}\ttfamily,
  keywords=[3]{each, findAll, groupBy, collect, inject, eachWithIndex},
  morekeywords={def, as, in, use},
  moredelim=[is][\textcolor{darkgray}]{\%\%}{\%\%},
  moredelim=[il][\textcolor{darkgray}]{§§}
}

\begin{document}

  \section{Setup}\label{sec:setup}

  \begin{enumerate}

    \item{ Micronaut CLI

      \begin{lstlisting}[language=bash]
$ brew list --versions micronaut
micronaut 1.3.4
      \end{lstlisting}

      Install Micronaut CLI
      \begin{lstlisting}[language=bash]
$ brew install micronaut
      \end{lstlisting}

      Upgrade Micronaut CLI
      \begin{lstlisting}[language=bash]
$ brew upgrade micronaut
      \end{lstlisting}
    }

    \item{ Create demo application using Micronaut CLI

      \begin{lstlisting}[language=bash]
$ mn create-app demo --lang=kotlin
| Generating Kotlin project...
| Application created at /.../demo
      \end{lstlisting}

      The following commands are executed from within the \textit{demo} directory

      Go into the \textit{demo} directory

      \begin{lstlisting}[language=bash]
$ cd demo
      \end{lstlisting}

      List the directory contents

      \begin{lstlisting}[language=bash]
$ ls -la
-rw-r--r-- .gitignore
-rw-r--r-- Dockerfile
-rw-r--r-- build.gradle
drwxr-xr-x gradle
-rw-r--r-- gradle.properties
-rwxr--r-- gradlew
-rwxr--r-- gradlew.bat
-rw-r--r-- micronaut-cli.yml
-rw-r--r-- settings.gradle
drwxr-xr-x src
      \end{lstlisting}
    }

    \item{ Build the application

      \begin{lstlisting}[language=bash]
$ ./gradlew clean build
      \end{lstlisting}
    }

    \item{ Run the application

      \begin{lstlisting}[language=bash]
$ java -jar build/libs/demo-0.1-all.jar
14:20:51.355 [main] INFO io...Micronaut - Startup completed in 1138ms. Server Running: http://localhost:8080
      \end{lstlisting}

      Make a request to application

      \begin{lstlisting}[language=bash]
$ curl http://localhost:8080
{"message":"Page Not Found","_links":{"self":{"href":"/","templated":false}}}
      \end{lstlisting}

      Stop the application (\texttt{[CONTROL] + [C]})

      \begin{lstlisting}[language=bash]
15:02:49.278 [Thread-2] INFO io...Micronaut - Embedded Application shutting down
      \end{lstlisting}
    }
  \end{enumerate}

\section{Configure Application}

\begin{enumerate}

\item{ Open the application
\begin{lstlisting}[language=bash]
$ idea .
\end{lstlisting}
}

\item{ (\textbf{Optional}) Take advantage of the Kotlin DSL

Convert the \textit{build.gradle} file into Kotlin DSL \textit{build.gradle.kts}
\begin{lstlisting}[language=Kotlin]
import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar
import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

plugins {
application
kotlin("jvm").version("1.3.50")
kotlin("kapt").version("1.3.50")
kotlin("plugin.allopen").version("1.3.50")

id("com.github.johnrengelman.shadow").version("5.2.0")
}

repositories {
mavenLocal()
jcenter()
}

val developmentOnly: Configuration by configurations.creating

dependencies {
val micronautVersion = "1.3.4"
val kotlinVersion = "1.3.50"
val jackson = "2.9.8"
val logback = "1.2.3"
val mockk = "1.9.3"
val kotlintest = "1.1.2"
val kotlintestRunner = "3.3.2"

implementation(platform("io.micronaut:micronaut-bom:$micronautVersion"))
implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion")
implementation("org.jetbrains.kotlin:kotlin-reflect:$kotlinVersion")
implementation("io.micronaut:micronaut-runtime")
implementation("io.micronaut:micronaut-http-server-netty")
implementation("io.micronaut:micronaut-http-client")
kapt(platform("io.micronaut:micronaut-bom:$micronautVersion"))
kapt("io.micronaut:micronaut-inject-java")
kapt("io.micronaut:micronaut-validation")
kaptTest(platform("io.micronaut:micronaut-bom:$micronautVersion"))
kaptTest("io.micronaut:micronaut-inject-java")
runtimeOnly("com.fasterxml.jackson.module:jackson-module-kotlin:$jackson")
runtimeOnly("ch.qos.logback:logback-classic:$logback")
testImplementation(platform("io.micronaut:micronaut-bom:$micronautVersion"))
testImplementation("io.micronaut.test:micronaut-test-kotlintest:$kotlintest")
testImplementation("io.mockk:mockk:$mockk")
testImplementation("io.kotlintest:kotlintest-runner-junit5:$kotlintestRunner")
}

application {
mainClassName = "demo.Application"
}

tasks {
withType<KotlinCompile> {
kotlinOptions.jvmTarget = "1.8"
kotlinOptions.javaParameters = true
}

withType<JavaExec> {
classpath += developmentOnly
jvmArgs("-noverify", "-XX:TieredStopAtLevel=1", "-Dcom.sun.management.jmxremote")
}

test {
useJUnitPlatform()
testLogging {
events("passed", "skipped", "failed")
}

classpath += developmentOnly
}

named<ShadowJar>("shadowJar") {
mergeServiceFiles()
}
}

allOpen {
annotation("io.micronaut.aop.Around")
}
\end{lstlisting}

Delete the file \textit{gradle.properties} as this is not used anymore

Convert the \textit{settings.gradle} file into Kotlin DSL \textit{settings.gradle.kts}

\begin{lstlisting}[language=Kotlin]
rootProject.name="demo"
\end{lstlisting}

Build the projects
\begin{lstlisting}[language=bash]
$ ./gradlew clean build
\end{lstlisting}
}

\item { Update Dependencies Versions

Add the plugin: \textit{com.github.ben-manes.versions}
\newline
{\footnotesize \url{https://plugins.gradle.org/plugin/com.github.ben-manes.versions}}

\begin{itemize}
\item[] {

\textbf{Kotlin DSL}
\newline
Edit file \textit{build.gradle.kts}

\begin{lstlisting}[language=Kotlin]
plugins {
id("com.github.ben-manes.versions") version "0.28.0"
}
\end{lstlisting}
}
\item[]{

\textbf{Groovy}
\newline
Edit file \textit{build.gradle}

\begin{lstlisting}[language=Groovy]
plugins {
id "com.github.ben-manes.versions" version "0.28.0"
}
\end{lstlisting}
}
\end{itemize}

Check the version of the dependencies

\begin{lstlisting}[language=bash]
$ ./gradlew dependencyUpdates
\end{lstlisting}

Update the versions based on the recommendations.

\begin{itemize}
\item  Gradle: \texttt{6.4-rc-2}
\item  Kotlin: \texttt{1.3.72}
\item Micronaut: \texttt{2.0.0.M2}
\item Jackson: \texttt{2.11.0.rc1}
\item Logback: \texttt{1.3.0-alpha5}
\item Kotlintest: \texttt{1.1.5}
\item Kotlintest Runner: \texttt{3.4.2} (experienced some issues with this version and had to revert to \texttt{3.4.0})
\end{itemize}

Build the application to confirm that all is in order.

\begin{lstlisting}[language=bash]
$ ./gradlew clean build
\end{lstlisting}


}
\end{enumerate}

\section{Controller}

\begin{enumerate}

\item  Create Controller

\begin{lstlisting}[language=bash]
$ curl http://localhost:8080/greeting
\end{lstlisting}


\end{enumerate}

\section{Others}

\begin{enumerate}

\item Make a request to application
\begin{lstlisting}[language=bash]
$ curl http://localhost:8080/greeting
\end{lstlisting}


\item Clear all local changes
\begin{lstlisting}[language=bash]
$ git fetch origin
$ git reset --hard origin/master
$ git clean -f
\end{lstlisting}

\end{enumerate}

\end{document}
